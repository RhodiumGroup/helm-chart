sudo: required
language: python

services:
- docker

python:
- 3.6

git:
  depth: false

env:
  global:
  - PATH=$HOME/google-cloud-sdk/bin:$PATH
  - PROJECT_ID="rhg-project-1"
  - ZONE="us-west1-a"
  - GOOGLE_APPLICATION_CREDENTIALS="${PWD}/travis-deploy.json"
  - secure: Qi5Zx2XwLS2i07mzXUWcXPycjTgZa+2HNAN0lc8kJp0xqmM5DXueMh9iiftkp5UQhIw9CXv4LnpmiZknTiBbz5LssXqyjKCYLJAklr9arPupvVNafIFSYd7FFk1pRVmqql+Gg+2xCoouChfY0IiVOp+2M5vuk8hpJsy+Xh6u8KI8fzqzzrWAHQwTTj0mDAov3DjAzmIdglcV+Wj2E29/pUezCeBcdO1S9JJzA5lMnNHaQl1ejQPGR3NsGQCklx588vTkgLAvX4rlgmuaxt5K/bDkoBHA94d8OitbEciMKO2dnSfKK82WS+zmGhGgMzdFtZxM30qwgDOeGXNtd8dUrWKacVRYtjyFnH1/xlrbrz5UKeeYSfCQ6893nM74g3ArHcO+J0Bq+bGU4kJixZlcrinGScstO/gsv4dnFLYZYBrTs+YEv9vzievwWppWHZnk26rynH07qN9N985A4EWbpmpjHAQVm4+guIAUzPo9tZtwKjmkQbrb/ChMxK5GgpH5lt0P4yaInz4Fy5cJvBxjwAr2jxhHEug6BAFkQcc3uocIkFj+wIMyUXsPzm8eUFDsTGTRSQqqKrniAtCnhD9RolzucF7DTG5yNsHeY2QYZVjLMqWzETenoMDkMGqoYPgJpvhgSaPUTya2eZFuOtqQXsrUjLkCgPnFNVvjpZwFmMw=
  - secure: i69wp3Wvvfkw3HNsOhCPwVA/+oovIX8D3vNy6pupL+iP9tVemFulxpDWvQE40gTd+YwqPyOt9rvX8g/BNrFDsWwXGtujJCHp5vAIJpUFekBBc+d67zCeY4Iz9299xa6oFG5s9u+rRofgwEno3nCMN7cn9WxRRyNY2pmqjE/CCVnlmR2/ovsJ6S04ck8shnhe5ZB6MBBAh7p9RjKr8XEo1S+OMoRxxe03CNKSkGs8+7gTvUPiPrb3uM4XN7JL+QVp2We9F84+XIaplrQg7NM0qhINzMU/Dzek819A0tUHLjkRzCIYIDpHJr4MFVQ2YlAvqoHepQbLNcGziAxXW4wOZu/YN86DG+Xwir2/hiWa0NXzgszwTmitsigBHFr6wC4BYYnIk3t2ODIRGe5YF9hzxpsYIG5JNyzGj1qdU4w3MYRI7hQrJYnhZfvk3KSeYSkqvX8drv+BtJi7xGOcH1xP+LQJtE1N0V3xR7zGhQOMtQ6rIc/jCsq1gwv2rx4MsL7DTMb+QPqI8Lc6bnhH0PieBiztDXt3QJib3dxta/g3Uqn224vE/lerp7PBXTTSL13HzZFdFgQyI0zEz96SPqKsl76LIWAzveLmTXKN7v6jV8WX+quJ8WRaV0Dc3SSvU/4Voxy7W7rG47ZSRliqKecOeRC7wLeSh8G3VtxHB5FH7QA=
  - secure: ZIg19oKNgPSCoOuulW6rstLj2HDTAyJV61lzb4y3oR7fHZttY9tN1Euaz9PS07fhCuFuOgkN8hQQT3n4a1RwerUXxqYpfAqdn6pNImBQqVZn+2eLL93/EWOQYwAYdeEvKPi6yoR2B6WJIjbAa3WSMFP+OlLDfJxYa4PDVCwNafj8GXoH9HrZuEVWBCRIXJpKqPNu4GhLGezzbtnnTmhtoP/TzZPJjWfX4LXcDX72nNYHOCcN3WMSDj7C0WWunEnx38mVcHzRDOKIS29LImD4XnZvtOu8/HICyniQ88bSPjEf3t26V1gvrywg9IYHSwQ3TMnEY7RfKEkT/eYEf1H6RIKxoZtzZT+BNxtH9hA/h17jaGAfH0p4AnRJHGKrQmQc4zjJfmlvlyLBuTP+1be4UaaAD2ERotCqcs5LK4H/bp92ePU/gvq1afZvK63w6G7XZkbtQbABzOtscGIpToPqk7epT15h/zY9OSIiBBU9TnggrVxjgQn6I+6LqkZyT70ZONNVH8QVXcwmx/woBZBTfPSfasogSPWiJNunw5LXc4YT3mTukk9eBXvKuGRFm3c8QIlx0Bo5NxmUKru48p5hjlu5V0Sz6B+m3Kh2nfsfK+fCpLxQzbBb9NKwtKSwtDBIa4TmRlhasqrlKJ277aepbFGF0FifK6n6RFz8vsF3KCo=
  - secure: LN/InihGYN6zWXny7MMBL5UsgRDZtxyElhoMEFE4iY0YYzFzUL5lPtca76MyEvm3QWHB/4wpOPDVtVlTLzCxDN+UhqcPAcIbfV9bSXV72O3iyOna8i3WDM7E/swcvHjk0ebXKSMJsz02zoV7Bp6Mg0ylgtsz85vea/BWK8w8vFOejbr/2EdfgxvD3scXtLWn+TZQaWPBPl4fLCYJghnQv1skNx9dhvpiq9eZXijJ4gt0S5ZxOMA8w+wM5jT9om228qRZy+23/RGGA5RUtrqeuUNsVGM1n6TwqoGFhvcn0F31O0/jffqlUSipVYkC3APi8TqQ8aJQiFXiYVTNxgkBNuE9Je1CtY75uVjKcKcYQzGWFC6F24BTyQic4YdUmheW7EBiCzHT5sqq/qxjlodvuicEYlh6icqyaJccTVYyMhDvbBOHN1swW0xn5sjBeiOTnUefPmhJ1L6NlfuMsP2MY7ENWAtwuVqjAB6SkdQn0bhZiGrx8HtgXV8gO52h0m/v83R0B+3C2mY/7e6bUBYHI9Ia8shdYhC7OuR0+H6gRa9N+b2R7Q14zvjOrJt9ejEoFbc6ZIMPMtjNWh/jWhPq6V3tB12cfoZKxjpc2v8hwZKwc+erH9cs+u+uN+AiB+UnuUqHBL2/KioLpZZx045KtO3SgKqSmJF+BeDRJ6oans8=
  - secure: bcXTKgUHTfokcjV8t/gM81fdaloum4TfzSgGQ0rJCItLkA/z6jpwSQUghL1NUxO9R36x/nnB4R0OXi0siBL4vIpe4hcpO/eG0pp8KZBrXw0S+ijIq2ruuSSRGqU34pKBLlGFj32Rpwn3qG5YZdTZtiOWdXMwlOXCrii8KJoeeXdnFihUVwHpqz2f/oLdqck15eGvrtsTuS+1SI/vGOeg+3C+/YFtloP1MaV8jJ4DPNGtiKh83pMlYnn7B+EPARIEfcc0RPTLQ2HHFUgTaCMC0YdwdV1vTmcFNlNvTTBF/BNjEuhuPAg7qyNst8CnvCMftuQESbb1MZVtFb8CZjf0DI00XztvMja3yUgLGEmpEc7eNEwyHbtU92ozc3BCyujasze7gSHRkdBUvMJpZ2ZdiwZzxSdeLA8T5KV4SCTzOJ9fPsUz4Zd17sfomeEWR0a75JpUJi0kUu8HikJLZJrgqcYQTeYPtQolELbjpzQxA5q9shhm4eHv5b/S9M+fhmmdjNR48IHFOVYnG97C7i8fn/GZPfELNvwKb4MtwfhPpGjZEQowySPeD8dPeR4tokGEeMaN7tJFBTvimdtnZHAxorftxSEIQk5f7uYWgzGcFoIuBq89e75YLexWInlzEZ6w0bnZXAgzDhzd4FHSPmhpEeAVCvlVPVLXeQppRInwaTI=
  - secure: 1bgxMakD/k+EiGDNg5oz9akBVeVZqI4NILwqyTleBc8V97IaN7C7Jwh5CbqcztdeUhIoGTDQk0N3cHUrC4kGFo2xAqZdS/GsP9zI8Oh4Cvn5XELQUxHSgM6WKMWlidAbdRSc4qCG3W4mNNIyKyULoSVp/f+WJ1ivt3RPe8WyvbeOyp+7yFJ8dQH6HwrOx3yEZaoYeLe94dZa94mcZfgFFwMDYddnyIy0Ipbcq+6exQ0+vZajg1S6KG6dKxEotksV5w2v/CdUWX2ARA6rI5Gmp98KS8nI0HtL/nwvrSJanhSgdaaB7fDk9vtSGKcq+F9hJeddwH1OWzJdGPYdKdsjAzxxcFmfsnwfOzWEam/jh2ZHcYr30k/perGVgJ6q1iUkAZjwlZhW3xK1subcQjk8tRbSMaU24Q+Uz31ho+iRVYCZ8xpoG+slwA4fyBFL5gil2I+wN0TiOO2MGvwiAoZSG2N1sECM+Wy++3+lxEKvPlYuGGD9/KXHVOxVT8YuL0O6n4o1v1P/FSFAzDQnZHboPbYNAiT3julooX2pR1hGalE56hRyGUS4th7lgi+Jl997FfJmmqkkKrHwGyEukDVHhAv7GEWP+XylXjkSPA9I0XK8B4Qk8V6hCTiw+mm+qdl8u0ef5m1EXjbBzZCCxuLXmK3x5irack4VgNZq5Z64C+8=
  - secure: ScLV7wD8WpfNAlnYHztnE01jBlD0FQemwlUCa2UvDHQWDry9ceVGw+TQu7P63yNSS8V7P8aSmMYgndWJsisVeQ5qK6mMKhy4fCfbQI5m89Lxnz5KzLOC4fgOEE7rKXwgSOKKFDzZiAkKjpPi+ICMwe4QNdscDPkVLF3sL9NZQw8Dh1kxRkLoWbePgY8ArL2/ltB4gEhbiMEPc4QUD5WHRC9ACS6KE5R2X7f6u9c3LDAmMG4rBE9mOdOGYKXSykSeXEHKLlgqQ/gWEPYPPjgHlUmOWmcWxj5J38XhA1O5WRRvEHVYiGgUOpxpqA/x12jj4Oha3rM6tI7b9KP9f17c/NZjJuwdRQnaEOcRei1IQYWMUZmCpW6lPCQJp4hEraqPNVuYkgkLcxBtxvvgrvqEzRun9/ZNO7XbG8Pm9M6JZ4+7L6QP7TM2wb1WbcXs+mJNSMxlWjAky3U/Iz6A/fnhftCNt8rbfcBiPm4x+GXnoBe9GJPlSKctHQsFF/9soRC+sPIF+tE7rQq6S9EOrGlrkiqxZlqL0Q/cOhOPAZYmtHtFhLDBp7LBvN79Giv+6lLhfOH//uJ90Ji8lw6LOz8vbfJGbJBdqgeboVfqhQ2fkF4tEta3Xhv8qp9vu01B85PebR5Gvu6J+bzTldgLHpAaV6dbaVJRzh/KFogL3Xc14NU=
  - secure: 1Ryqg1HwHwtpycrnSDcaYTL5v+fgVumhcPWhtqsMhD0QagDWEtcGh7Cu63G4OiHuj0SjgzcTnUwyUQjbrrk9d1fBY8cwiEmZ5gNj31O/kLYvYD3bK2FHhM3z7KYjECra5LzArNCnX2ILYLwOE0QttEQ9nS3Sk6unrIQAuyrlphOSwFbjka6ibsBM5TJBPxxAsugx40cwktipys5PlIFVIj7lu04bDNLieiTFq428qGzFt8EJdoMgdY0zqg+92HYfvIm5rsJ4OrPmCp8dI2HB2ExXu19LNevBuEAg/+b/ScSH3LueQ01F4lwqmMhyoex0FkTIj7MEZxF5AIkE5acZROTspfhh1F4gwCOctVJY4T1tli6YhZFqzGLlExPSwhWldbOyTBAFvrB37hGERl3n+vryomHcwJY1wbXIbSxsYYL1MwwfpVYKQUUA9V/3cQJYkfBDJdokriRYzGQdFr+hNVaSFHAJvpTMXYKKEUjyUan/AiM7XkUyP4WRATUXYSzmoyma0vAdDaN2xnObN6YIeGLcx9DBRB+KtEN8rWeK1KahtummL6wDKAOCPVNLZsxcFfRIyTvD9uZd4hdSylAA0u/OgdT4jI06V7nszQ3Ewd1hg7hLw79w+ksUEK/NlrL0UKNhz6aT7zygXxXioohh5u1gVyL0JmeO3rsRuGwxgE8=
  - secure: kkb8R9v3txrtE3OurFmzXa8t3pyH+3/3lgMhuK9FL3Lfq//7itFjZdGe+RSQcvk3+jxVvuHuYz3+D0epMvA+J8Rlj/N4M0iVq9n94asuUBq/MN+5xz/ezUPpQpSBimlFEPGba2gWTNSEVTcXvrmrpc+4g100dxE8YQ5FaW5klazAckl7GDQy2876g+7RDtXx7W2UX2EEi3NUu3mGItjoRrMC0Ao1wlPg9j0OM5m+9S1uNcaz3VSN1Wju8+bekxbc40U9PjQOybkcQGR9a62yd8sDwqBSAS82FPNi9RaTbDdkiCcJt+D5gJyCuRWLwmekY2MbO6albatM5ACLDh1ccPgmxdYGzQG5eetyTNTn3dOcczbrm3Py7/Uu+Zd27LSez4IodMK1ORTZJz3dLOJmlK4WxTIjtOgkkYNsMBIMNHO0yIHBba7MtSvR8BxkI2j48xwVnKLDH/s/oWEmWUjlptf3m/w0zv0MWbrN0yLlgodlm0OWfbnBZvCQyR0jVPSSaAFzfI4j0zO5u+WcVajmVPrwu+jmfI6B8UPV78EouU44GMxkFSnFHpvJ4lZqUDSibmffrzWUYny+QCmMxDJZohUgfEF7C+/uVOX3AruVDCLr+LS5txfsksqrcPIbFJq+058iV3/EZ+D4LAopJJnKS2BHkSyEg5i25yct/9IEsnc=
  - secure: Pn+/VtjMQqJDZQtxbAxDT/B/DHC1BqauUVApSeU0TFmSu5PawLo2mcS+glJGqBDqobps6ronXAl69SW5g0kmxb9sZ7qLLD4D2Zt1CsdZ04G+686fZTeTdwnGVg5nPUxxXUgPHCKfeDZvt3GStoJ9EikpmUYc+LLthfxD89Xw2o8mIJ1jT35Fmf2aOL7HV7HA7YlN+zr6nmAJUGDgi+ogNR4GQEr6pcgRwQtTqW/Y4FDFfNkoEPpkRwTLsKpczoZBlD9IgMz1cys3ybtjZ1lFnVy8uBMuvAhWd5xqoYFTFKGFOC8BvVZKtRr2pBvkDUsPwV7q7vvrXSn+rc/zdncErJqJxSWNCieP3uCiABQapB7s4fYvsdO/1C4mJJWwPK/kEBp7hEowQWRWLT3rwtOay4pPxkxPWFeynu3Ev5sf4s/0wMC0JiFZRl/qME/kgMOMQhFgUvFkq4i3+Lyh6V97VU0rchP08xIfwzNtZVQGRRkSaW6OzfUwDmBOQt0bd0oXu1odYkcndVx1D4/GyVzFgViBVkIhnycIDG61XPYILmN9oYaOgzbLkNR7YuS0TsIlTfaKuQ3HtDablpVYV8J7oAVINIqN+1oBAp5bpxQGLQ/4m3p59i6V5Yqo14nIGzKN5UmGDpxgeLF+RzVSZtUpwwPkRMWrTMlvrgVhjpoiOZ8=

before_install:
- openssl aes-256-cbc -K $encrypted_c2d5bc89b8b9_key -iv $encrypted_c2d5bc89b8b9_iv -in travis-deploy.json.enc -out travis-deploy.json -d

install:
- pip install pyyaml
- sudo apt-get update && sudo apt-get install -y apt-transport-https
- curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
- sudo touch /etc/apt/sources.list.d/kubernetes.list 
- echo "deb http://apt.kubernetes.io/ kubernetes-xenial main" | sudo tee -a /etc/apt/sources.list.d/kubernetes.list
- sudo apt-get update
- sudo apt-get install -y kubectl
- # Install Helm
- curl -Lo /tmp/helm-linux-amd64.tar.gz https://kubernetes-helm.storage.googleapis.com/helm-v2.10.0-linux-amd64.tar.gz
- tar -xvf /tmp/helm-linux-amd64.tar.gz -C /tmp/
- chmod +x  /tmp/linux-amd64/helm && sudo mv /tmp/linux-amd64/helm /usr/local/bin/

script:
  - echo "done"
# script:
# - bash test_pairing.sh

deploy:
- provider: script
  skip_cleanup: true
  script: bash deploy-test.sh
  on:
    branch: dev

- provider: script
  skip_cleanup: true
  script: bash deploy-prod.sh
  on:
    branch: master

