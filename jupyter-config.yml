jupyterhub:
  # until resolved: https://github.com/jupyterhub/zero-to-jupyterhub-k8s/issues/1393
  prePuller:
    hook:
      enabled: false
    continuous:
      enabled: false
  singleuser:
    # see https://jupyterhub-kubespawner.readthedocs.io/en/latest/spawner.html for a
    # description of configuration options
    image:
      pullPolicy: 'Always'
      name: rhodium/notebook
      tag: v0.3.0-alpha.1
    startTimeout: 900
    profileList:
      - display_name: "Rhodium:base stable"
        description: "This is the stable build of our <a href=\"https://github.com/RhodiumGroup/docker_images/tree/v0.3.0-alpha.1\">default notebook</a>. Use this if you're not sure."
      - display_name: "Rhodium: base stable (large)"
        description: "Larger notebook allowance, with known stable build of <a href=\"https://github.com/RhodiumGroup/docker_images/tree/v0.3.0-alpha.1\">default notebook</a>"
        kubespawner_override:
          cpu_limit: 7.5
          cpu_guarantee: 7.5
          mem_limit: 45G
          mem_guarantee: 45G
      - display_name: "Rhodium:base latest"
        description: "This is the version of the notebook deployed on <a href=\"https://github.com/RhodiumGroup/docker_images\">docker_images@master</a>. Use this if you want to test out new features!"
        kubespawner_override:
          image: rhodium/notebook:latest
      - display_name: "Rhodium:base latest (large)"
        description: "Larger notebook allowance, with the latest build of <a href=\"https://github.com/RhodiumGroup/docker_images\">docker_images@master</a>"
        kubespawner_override:
          image: rhodium/notebook:latest
          cpu_limit: 7.5
          cpu_guarantee: 7.5
          mem_limit: 45G
          mem_guarantee: 45G
      - display_name: 'Coastal: pyTC stable'
        description: "Known stable build of <a href=\"https://github.com/RhodiumGroup/docker_images/tree/pyTC-v0.1.0\">rhodium/docker_images@dev-pyTC-base branch</a>"
        kubespawner_override:
          image: 'rhodium/notebook:pyTC-v0.1.0'
      - display_name: 'Coastal: pyTC stable (large)'
        description: "Larger notebook allowance, with known stable build of <a href=\"https://github.com/RhodiumGroup/docker_images/tree/pyTC-v0.1.0\">rhodium/docker_images@dev-pyTC-base branch</a>"
        kubespawner_override:
          image: 'rhodium/notebook:pyTC-v0.1.0'
          cpu_limit: 7.5
          cpu_guarantee: 7.5
          mem_limit: 45G
          mem_guarantee: 45G
      - display_name: 'Coastal: pyTC latest'
        description: "Latest build of <a href=\"https://github.com/RhodiumGroup/docker_images/tree/dev-pyTC-base\">rhodium/docker_images@dev-pyTC-base branch</a>"
        kubespawner_override:
          image: 'rhodium/notebook:coastal-gateway'
      - display_name: "Coastal: pyTC latest (large)"
        description: "Larger notebook allowance, with the latest build of <a href=\"https://github.com/RhodiumGroup/docker_images/tree/dev-pyTC-base\">rhodium/docker_images@dev-pyTC-base branch</a>"
        kubespawner_override:
          image: 'rhodium/notebook:coastal-gateway'
          cpu_limit: 7.5
          cpu_guarantee: 7.5
          mem_limit: 45G
          mem_guarantee: 45G
    storage:
      capacity: 10Gi
      dynamic:
        # storageClass: ssd
        storageClass: standard
    cpu:
      limit: 3.75
      guarantee: 3.75
    memory:
      limit: 22.5G
      guarantee: 22.5G
  hub:
    resources:
      requests:
        cpu: "0.25"
        memory: 0.5Gi
      limits:
        cpu: "1.25"
        memory: 1Gi
    extraConfig:
      customPodHook: |
            # runs container in privileged mode for FUSE mount access
            from kubernetes import client
            def modify_pod_hook(spawner, pod):
                pod.spec.containers[0].security_context = client.V1SecurityContext(
                    privileged=True,
                    capabilities=client.V1Capabilities(
                        add=['SYS_ADMIN']
                    )
                )
                return pod
            c.KubeSpawner.modify_pod_hook = modify_pod_hook
            c.JupyterHub.logo_file = '/usr/local/share/jupyterhub/static/custom/images/logo.png'
            c.JupyterHub.template_paths = ['/usr/local/share/jupyterhub/custom_templates/']
# The templates section is borrowed from the pangeo approach, i.e.
# https://github.com/pangeo-data/pangeo-cloud-federation/blob/staging/deployments/ocean/config/common.yaml
    extraVolumes:
      - name: custom-templates
        gitRepo:
          repository: "https://github.com/RhodiumGroup/rhodium-custom-jupyterhub-templates.git"
    extraVolumeMounts:
      - mountPath: /usr/local/share/jupyterhub/custom_templates
        name: custom-templates
        subPath: "rhodium-custom-jupyterhub-templates/templates"
      - mountPath: /usr/local/share/jupyterhub/static/custom
        name: custom-templates
        subPath: "rhodium-custom-jupyterhub-templates/assets"
    services:
      dask-gateway:
        apiToken: OVERRIDEME
  scheduling:
    userScheduler:
      enabled: true
    userPlaceholder:
      enabled: false
    userPods:
      nodeAffinity:
        matchNodePurpose: require
    corePods:
      nodeAffinity:
        matchNodePurpose: require
  cull:
    timeout: 259200

  proxy:
    secretToken: OVERRIDEME
    https:
      letsencrypt:
        contactEmail: mdelgado@rhg.com

  auth:
    type: github
    scopes:
      - "read:user"
    orgWhitelist:
      - RhodiumGroup
    admin:
      access: true
      users:
        - bolliger32
        - brews
        - delgadom
        - dgergel
        - mattgoldklang
    whitelist:
      users:
        - dpa9694
        - njdepsky

dask-gateway:
  gateway:
    auth:
      jupyterhub:
        apiToken: OVERRIDEME
    backend:
      worker:
        extraPodConfig:
          tolerations:
            - key: "cloud.google.com/gke-preemptible"
              operator: "Equal"
              value: "true"
              effect: "NoSchedule"